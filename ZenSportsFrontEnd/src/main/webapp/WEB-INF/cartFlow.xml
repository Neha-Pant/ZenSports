<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow 
      http://www.springframework.org/schema/webflow/spring-webflow.xsd">
      
      <var name="billing" class="net.sports.ZenSportsFrontEnd.model.Address"/>
      <var name="shipping" class="net.sports.ZenSportsFrontEnd.model.Address"/>
       <var name="cartitem" class="net.sports.ZenSportsFrontEnd.model.CartItem"/>
     
<!-- Executed when webFlow is triggered -->
       <on-start>
       <!-- registerHandler is java class available through annotated RegisterHandler.java class. -->
       <evaluate expression="cartHandler.initializeModel()" result="flowScope.cartModel"/>
       </on-start>

       
       <view-state id="start" view="billingCart" model="billing">
          <transition on="submit" to="shippingAddress"/>
          <on-exit>
                    <evaluate expression="cartHandler.saveBillingAddress(cartModel,billing)"></evaluate>
             </on-exit>  
       </view-state>
       
       
       <!-- User enters Billing Address -->
       <view-state id="shippingAddress" view="shippingCart" model="shipping">
          <transition on="submit" to="pay"/>
          <on-exit>
                    <evaluate expression="cartHandler.saveShippingAddress(cartModel,shipping)"></evaluate>
             </on-exit>
       </view-state>
       
       <!-- User enters Shipping Address -->
       <view-state id="pay" view="payment" model="payment">
          <transition on="submit" to="invoice"/>
          <on-exit>
                    <evaluate expression="cartHandler.savePayment(cartModel,payment)"></evaluate>
             </on-exit>
       </view-state>
       
       <!-- User view order payment -->
       <view-state id="invoice" view="invoice" model="flowScope.cartModel">
       
             <transition on="submit" to="storedetail" />
          
       </view-state>
       
       <action-state id="storedetail"> 
             <evaluate expression="cartHandler.storeDetail(cartModel)" ></evaluate>
             <transition on="success" to="toHome" />
             <transition on="failure" to="start" />
       </action-state>     
       
<end-state id="welcome" view="toHome" />      
       <end-state id="toHome" view="externalRedirect:contextRelative:/cartview" />
       <end-state id="toException" view="externalRedirect:contextRelative:exception.jsp" />

       <!-- these events are available in every state-->
       <global-transitions>
             <transition on="home" to="toHome" />
             <transition on="error" to="toException" />
       </global-transitions>
</flow>
       

